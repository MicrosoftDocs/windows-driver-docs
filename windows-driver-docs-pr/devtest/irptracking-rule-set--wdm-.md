---
title: IrpTracking rule set (WDM)
description: Use these rules to verify that your driver correctly tracks I/O request packets (IRP) so that the device is not removed while IRPs are outstanding.
ms.assetid: 9AD62397-6840-42FF-ADEC-6836EDD16647
ms.date: 05/21/2018
ms.localizationpriority: medium
---

# IrpTracking rule set (WDM)


Use these rules to verify that your driver correctly tracks I/O request packets (IRP) so that the device is not removed while IRPs are outstanding.

## In this section


<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Topic</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><a href="wdm-ioreleaseremovelockandwaitoutsideremovedevice.md" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWaitOutsideRemoveDevice&lt;/strong&gt;](wdm-ioreleaseremovelockandwaitoutsideremovedevice.md)"><strong>IoReleaseRemoveLockAndWaitOutsideRemoveDevice</strong></a></p></td>
<td align="left"><p>The <a href="wdm-ioreleaseremovelockandwaitoutsideremovedevice.md" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWaitOutsideRemoveDevice&lt;/strong&gt;](wdm-ioreleaseremovelockandwaitoutsideremovedevice.md)"><strong>IoReleaseRemoveLockAndWaitOutsideRemoveDevice</strong></a> rule specifies that <a href="https://msdn.microsoft.com/library/windows/hardware/ff549567" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWait&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549567)"><strong>IoReleaseRemoveLockAndWait</strong></a> should not be called outside IRP_MJ_PNP with IRP_MN_REMOVE_DEVICE for a PnP driver.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-nsremovelockmnremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockMnRemove&lt;/strong&gt;](wdm-nsremovelockmnremove.md)"><strong>NsRemoveLockMnRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-nsremovelockmnremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockMnRemove&lt;/strong&gt;](wdm-nsremovelockmnremove.md)"><strong>NsRemoveLockMnRemove</strong></a> rule verifies a driver does not return STATUS_NOT_SUPPORTED when processing IRP_MJ_PNP with MinorFunction IRP_MN_REMOVE_DEVICE. This rule only applies to FDO and FIDO drivers.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-nsremovelockmnsurpriseremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockMnSurpriseRemove&lt;/strong&gt;](wdm-nsremovelockmnsurpriseremove.md)"><strong>NsRemoveLockMnSurpriseRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-nsremovelockmnsurpriseremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockMnSurpriseRemove&lt;/strong&gt;](wdm-nsremovelockmnsurpriseremove.md)"><strong>NsRemoveLockMnSurpriseRemove</strong></a> rule verifies that a driver does not return STATUS_NOT_SUPPORTED when processing an IRP_MJ_PNP request with minorFunction IRP_MN_SUPRISE_REMOVAL. This rule only applies to FDO and FIDO drivers.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-nsremovelockquerymnremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockQueryMnRemove&lt;/strong&gt;](wdm-nsremovelockquerymnremove.md)"><strong>NsRemoveLockQueryMnRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-nsremovelockquerymnremove.md" data-raw-source="[&lt;strong&gt;NsRemoveLockQueryMnRemove&lt;/strong&gt;](wdm-nsremovelockquerymnremove.md)"><strong>NsRemoveLockQueryMnRemove</strong></a> rule verifies a driver does not return STATUS_NOT_SUPPORTED when processing IRP_MJ_PNP with MinorFunction IRP_MN_QUERY_REMOVE. This rule only applies to FDO and FIDO drivers.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelock.md" data-raw-source="[&lt;strong&gt;RemoveLock&lt;/strong&gt;](wdm-removelock.md)"><strong>RemoveLock</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelock.md" data-raw-source="[&lt;strong&gt;RemoveLock&lt;/strong&gt;](wdm-removelock.md)"><strong>RemoveLock</strong></a> rule specifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly. Moreover, at the end of the IRP_MJ_PNP or IRP_MJ_POWER routine, the driver should not hold the <strong>RemoveLock</strong>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockcheck.md" data-raw-source="[&lt;strong&gt;RemoveLockCheck&lt;/strong&gt;](wdm-removelockcheck.md)"><strong>RemoveLockCheck</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockcheck.md" data-raw-source="[&lt;strong&gt;RemoveLockCheck&lt;/strong&gt;](wdm-removelockcheck.md)"><strong>RemoveLockCheck</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549567" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWait&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549567)"><strong>IoReleaseRemoveLockAndWait</strong></a> are used correctly when processing IRP_MJ_PNP with MinorFunction IRP_MN_REMOVE_DEVICE.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockforward.md" data-raw-source="[&lt;strong&gt;RemoveLockForward&lt;/strong&gt;](wdm-removelockforward.md)"><strong>RemoveLockForward</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforward.md" data-raw-source="[&lt;strong&gt;RemoveLockForward&lt;/strong&gt;](wdm-removelockforward.md)"><strong>RemoveLockForward</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when forwarding a IRP to another device.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockforward2.md" data-raw-source="[&lt;strong&gt;RemoveLockForward2&lt;/strong&gt;](wdm-removelockforward2.md)"><strong>RemoveLockForward2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforward2.md" data-raw-source="[&lt;strong&gt;RemoveLockForward2&lt;/strong&gt;](wdm-removelockforward2.md)"><strong>RemoveLockForward2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when forwarding the IRP to another device.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockforwarddevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControl&lt;/strong&gt;](wdm-removelockforwarddevicecontrol.md)"><strong>RemoveLockForwardDeviceControl</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwarddevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControl&lt;/strong&gt;](wdm-removelockforwarddevicecontrol.md)"><strong>RemoveLockForwardDeviceControl</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when the driver uses <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to forward an IRP to a another device.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockforwarddevicecontrol2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControl2&lt;/strong&gt;](wdm-removelockforwarddevicecontrol2.md)"><strong>RemoveLockForwardDeviceControl2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwarddevicecontrol2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControl2&lt;/strong&gt;](wdm-removelockforwarddevicecontrol2.md)"><strong>RemoveLockForwardDeviceControl2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when the driver uses <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to forward an IRP to a another device.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockforwarddevicecontrolinternal.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControlInternal&lt;/strong&gt;](wdm-removelockforwarddevicecontrolinternal.md)"><strong>RemoveLockForwardDeviceControlInternal</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwarddevicecontrolinternal.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControlInternal&lt;/strong&gt;](wdm-removelockforwarddevicecontrolinternal.md)"><strong>RemoveLockForwardDeviceControlInternal</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in correctly when forwarding a IRP using <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to a another device.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockforwarddevicecontrolinternal2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControlInternal2&lt;/strong&gt;](wdm-removelockforwarddevicecontrolinternal2.md)"><strong>RemoveLockForwardDeviceControlInternal2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwarddevicecontrolinternal2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardDeviceControlInternal2&lt;/strong&gt;](wdm-removelockforwarddevicecontrolinternal2.md)"><strong>RemoveLockForwardDeviceControlInternal2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in correctly when forwarding a IRP using <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to a another device.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockforwardread.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardRead&lt;/strong&gt;](wdm-removelockforwardread.md)"><strong>RemoveLockForwardRead</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwardread.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardRead&lt;/strong&gt;](wdm-removelockforwardread.md)"><strong>RemoveLockForwardRead</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in correctly.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockforwardread2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardRead2&lt;/strong&gt;](wdm-removelockforwardread2.md)"><strong>RemoveLockForwardRead2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwardread2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardRead2&lt;/strong&gt;](wdm-removelockforwardread2.md)"><strong>RemoveLockForwardRead2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when forwarding a IRP using <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to a another device.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockforwardwrite.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardWrite&lt;/strong&gt;](wdm-removelockforwardwrite.md)"><strong>RemoveLockForwardWrite</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwardwrite.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardWrite&lt;/strong&gt;](wdm-removelockforwardwrite.md)"><strong>RemoveLockForwardWrite</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when forwarding a IRP using <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to a another device.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockforwardwrite2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardWrite2&lt;/strong&gt;](wdm-removelockforwardwrite2.md)"><strong>RemoveLockForwardWrite2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockforwardwrite2.md" data-raw-source="[&lt;strong&gt;RemoveLockForwardWrite2&lt;/strong&gt;](wdm-removelockforwardwrite2.md)"><strong>RemoveLockForwardWrite2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when forwarding a IRP using <a href="https://msdn.microsoft.com/library/windows/hardware/ff548336" data-raw-source="[&lt;strong&gt;IoCallDriver&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548336)"><strong>IoCallDriver</strong></a> to a another device.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockmnremove.md" data-raw-source="[&lt;strong&gt;RemoveLockMnRemove&lt;/strong&gt;](wdm-removelockmnremove.md)"><strong>RemoveLockMnRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockmnremove.md" data-raw-source="[&lt;strong&gt;RemoveLockMnRemove&lt;/strong&gt;](wdm-removelockmnremove.md)"><strong>RemoveLockMnRemove</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549567" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWait&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549567)"><strong>IoReleaseRemoveLockAndWait</strong></a> are used correctly when processing IRP_MJ_PNP with MinorFunction IRP_MN_REMOVE_DEVICE.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockmnremove2.md" data-raw-source="[&lt;strong&gt;RemoveLockMnRemove2&lt;/strong&gt;](wdm-removelockmnremove2.md)"><strong>RemoveLockMnRemove2</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockmnremove2.md" data-raw-source="[&lt;strong&gt;RemoveLockMnRemove2&lt;/strong&gt;](wdm-removelockmnremove2.md)"><strong>RemoveLockMnRemove2</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549567" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWait&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549567)"><strong>IoReleaseRemoveLockAndWait</strong></a> are used correctly when processing IRP_MN_REMOVE_DEVICE request before the IRP is forwarded to lower drivers.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockmnsurpriseremove.md" data-raw-source="[&lt;strong&gt;RemoveLockMnSurpriseRemove&lt;/strong&gt;](wdm-removelockmnsurpriseremove.md)"><strong>RemoveLockMnSurpriseRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockmnsurpriseremove.md" data-raw-source="[&lt;strong&gt;RemoveLockMnSurpriseRemove&lt;/strong&gt;](wdm-removelockmnsurpriseremove.md)"><strong>RemoveLockMnSurpriseRemove</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549567" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLockAndWait&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549567)"><strong>IoReleaseRemoveLockAndWait</strong></a> are used correctly when processing IRP_MJ_PNP with MinorFunction IRP_MN_SUPRISE_REMOVAL. The driver should acquire the remove lock before forwarding the IRP down the stack.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockquerymnremove.md" data-raw-source="[&lt;strong&gt;RemoveLockQueryMnRemove&lt;/strong&gt;](wdm-removelockquerymnremove.md)"><strong>RemoveLockQueryMnRemove</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockquerymnremove.md" data-raw-source="[&lt;strong&gt;RemoveLockQueryMnRemove&lt;/strong&gt;](wdm-removelockquerymnremove.md)"><strong>RemoveLockQueryMnRemove</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used correctly when processing IRP_MJ_PNP with MinorFunction IRP_MN_QUERY_REMOVE_DEVICE. The driver should acquire the remove lock before forwarding the IRP down the stack.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockrelease2.md" data-raw-source="[&lt;strong&gt;RemoveLockRelease2&lt;/strong&gt;](wdm-removelockrelease2.md)"><strong>RemoveLockRelease2</strong></a></p></td>
<td align="left"><p>The rule <a href="wdm-removelockrelease2.md" data-raw-source="[&lt;strong&gt;RemoveLockRelease2&lt;/strong&gt;](wdm-removelockrelease2.md)"><strong>RemoveLockRelease2</strong></a> verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleasecleanup.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseCleanup&lt;/strong&gt;](wdm-removelockreleasecleanup.md)"><strong>RemoveLockReleaseCleanup</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasecleanup.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseCleanup&lt;/strong&gt;](wdm-removelockreleasecleanup.md)"><strong>RemoveLockReleaseCleanup</strong></a> rule specifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Each call to <strong>IoAcquireRemoveLock</strong> must have a matching call to <strong>IoReleaseRemoveLock</strong>. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockreleaseclose.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseClose&lt;/strong&gt;](wdm-removelockreleaseclose.md)"><strong>RemoveLockReleaseClose</strong></a></p></td>
<td align="left"><p>The rule <a href="wdm-removelockreleaseclose.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseClose&lt;/strong&gt;](wdm-removelockreleaseclose.md)"><strong>RemoveLockReleaseClose</strong></a> verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleasecreate.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseCreate&lt;/strong&gt;](wdm-removelockreleasecreate.md)"><strong>RemoveLockReleaseCreate</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasecreate.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseCreate&lt;/strong&gt;](wdm-removelockreleasecreate.md)"><strong>RemoveLockReleaseCreate</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockreleasedevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseDeviceControl&lt;/strong&gt;](wdm-removelockreleasedevicecontrol.md)"><strong>RemoveLockReleaseDeviceControl</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasedevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseDeviceControl&lt;/strong&gt;](wdm-removelockreleasedevicecontrol.md)"><strong>RemoveLockReleaseDeviceControl</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleaseinternaldevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseInternalDeviceControl&lt;/strong&gt;](wdm-removelockreleaseinternaldevicecontrol.md)"><strong>RemoveLockReleaseInternalDeviceControl</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleaseinternaldevicecontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseInternalDeviceControl&lt;/strong&gt;](wdm-removelockreleaseinternaldevicecontrol.md)"><strong>RemoveLockReleaseInternalDeviceControl</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockreleasepnp.md" data-raw-source="[&lt;strong&gt;RemoveLockReleasePnp&lt;/strong&gt;](wdm-removelockreleasepnp.md)"><strong>RemoveLockReleasePnp</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasepnp.md" data-raw-source="[&lt;strong&gt;RemoveLockReleasePnp&lt;/strong&gt;](wdm-removelockreleasepnp.md)"><strong>RemoveLockReleasePnp</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleasepower.md" data-raw-source="[&lt;strong&gt;RemoveLockReleasePower&lt;/strong&gt;](wdm-removelockreleasepower.md)"><strong>RemoveLockReleasePower</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasepower.md" data-raw-source="[&lt;strong&gt;RemoveLockReleasePower&lt;/strong&gt;](wdm-removelockreleasepower.md)"><strong>RemoveLockReleasePower</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockreleaseread.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseRead&lt;/strong&gt;](wdm-removelockreleaseread.md)"><strong>RemoveLockReleaseRead</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleaseread.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseRead&lt;/strong&gt;](wdm-removelockreleaseread.md)"><strong>RemoveLockReleaseRead</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleaseshutdown.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseShutdown&lt;/strong&gt;](wdm-removelockreleaseshutdown.md)"><strong>RemoveLockReleaseShutdown</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleaseshutdown.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseShutdown&lt;/strong&gt;](wdm-removelockreleaseshutdown.md)"><strong>RemoveLockReleaseShutdown</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="wdm-removelockreleasesystemcontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseSystemControl&lt;/strong&gt;](wdm-removelockreleasesystemcontrol.md)"><strong>RemoveLockReleaseSystemControl</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasesystemcontrol.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseSystemControl&lt;/strong&gt;](wdm-removelockreleasesystemcontrol.md)"><strong>RemoveLockReleaseSystemControl</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
<tr class="even">
<td align="left"><p><a href="wdm-removelockreleasewrite.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseWrite&lt;/strong&gt;](wdm-removelockreleasewrite.md)"><strong>RemoveLockReleaseWrite</strong></a></p></td>
<td align="left"><p>The <a href="wdm-removelockreleasewrite.md" data-raw-source="[&lt;strong&gt;RemoveLockReleaseWrite&lt;/strong&gt;](wdm-removelockreleasewrite.md)"><strong>RemoveLockReleaseWrite</strong></a> rule verifies that calls to <a href="https://msdn.microsoft.com/library/windows/hardware/ff548204" data-raw-source="[&lt;strong&gt;IoAcquireRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff548204)"><strong>IoAcquireRemoveLock</strong></a> and <a href="https://msdn.microsoft.com/library/windows/hardware/ff549560" data-raw-source="[&lt;strong&gt;IoReleaseRemoveLock&lt;/strong&gt;](https://msdn.microsoft.com/library/windows/hardware/ff549560)"><strong>IoReleaseRemoveLock</strong></a> are used in strict alternation. Moreover, at the end of the dispatch routine the driver should not hold the remove lock.</p></td>
</tr>
</tbody>
</table>

 

**To select the IrpTracking rule set**

1.  Select your driver project (.vcxProj) in Microsoft Visual Studio. From the **Driver** menu, click **Launch Static Driver Verifierâ€¦**.

2.  Click the **Rules** tab. Under **Rule Sets**, select **IrpTracking**.

    To select the default rule set from a Visual Studio developer command prompt window, specify **IrpTracking.sdv** with the **/check** option. For example:

    ```
    msbuild /t:sdv /p:Inputs="/check:IrpTracking.sdv" mydriver.VcxProj /p:Configuration="Win8 Release" /p:Platform=Win32
    ```

    For more information, see [Using Static Driver Verifier to Find Defects in Drivers](https://msdn.microsoft.com/library/windows/hardware/hh454281) and [Static Driver Verifier commands (MSBuild)](https://msdn.microsoft.com/library/windows/hardware/hh466459).

 

 





