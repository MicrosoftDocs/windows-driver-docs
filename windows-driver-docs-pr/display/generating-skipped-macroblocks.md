---
title: Generating Skipped Macroblocks
description: Generating Skipped Macroblocks
ms.assetid: 98ea004b-347d-4299-a23c-da0a9d0e844f
keywords:
- macroblocks WDK DirectX VA , skipped macroblocks
- skipped macroblocks WDK DirectX VA
ms.date: 04/20/2017
ms.localizationpriority: medium
---

# Generating Skipped Macroblocks


## <span id="ddk_generating_skipped_macroblocks_gg"></span><span id="DDK_GENERATING_SKIPPED_MACROBLOCKS_GG"></span>


The generation of a skipped macroblock in DirectX VA differs somewhat from that in MPEG-2 Video Section 7.6.6. In DirectX VA skipped macroblocks are generated in a separate macroblock control command, rather than being inferred from the type of the preceding nonskipped macroblock and the type of picture displayed (for example, in MPEG-2, the method of generating skipped macroblocks depends on whether the picture is a [*P picture*](https://msdn.microsoft.com/library/windows/hardware/ff556325#wdkgloss-predictive-coded-picture--p-picture-) or [*B picture*](https://msdn.microsoft.com/library/windows/hardware/ff556272#wdkgloss-b-picture).)

The following conditions are required when generating and using skipped macroblocks:

- Skipped macroblocks have no residual differences.

- Skipped macroblocks can be generated by repeating the operation of a macroblock control command with an incremented **wMBaddress**. (Each subsequent skipped macroblock is generated in the same way as the first, except for incrementing the value of **wMBaddress**.)

- Macroblock skipping is restricted from wrapping to a new row of macroblocks in the picture. (A separate macroblock control command must be sent to generate the first macroblock of each row of macroblocks.)

- The content of a macroblock control command with a nonzero value for *MBskipsFollowing* is equivalent (except for the value of *MBskipsFollowing*) to the content of an explicit specification of the first of the series of skipped macroblocks. Thus, whenever *MBskipsFollowing* is not zero, the following structure members and variables must all be equal to zero: *Motion4MV, IntraMacroblock,* **wPatternCode**<em>, and</em> **wPC\_Overflow**.

Because of the first three preceding conditions, an accelerator may implement motion compensation (when *Motion4MV* is zero) by applying the specified motion vectors to a rectangle of width equal to the following expression in the luminance component, and to a similarly specified rectangle in the chrominance components. This rectangular-area motion compensation method can be performed by the accelerator rather than by using *MBskipsFollowing*+1 repetitions of the same macroblock control operation.

```cpp
(bMacroblockWidthMinus1+1) X (MBskipsFollowing+1)
```

The **bMacroblockWidthMinus1** member is contained in [**DXVA\_PictureParameters**](https://msdn.microsoft.com/library/windows/hardware/ff564012). The *MBskipsFollowing* variable is in the **wMBtype** member of each macroblock control structure.

### <span id="Skipped_Macroblocks_in_H.263__Annex_F_"></span><span id="skipped_macroblocks_in_h.263__annex_f_"></span><span id="SKIPPED_MACROBLOCKS_IN_H.263__ANNEX_F_"></span>Skipped Macroblocks in H.263 (Annex F)

The generation of skipped macroblocks in H.263 with advanced prediction mode active (Annex F), requires representing some skipped macroblocks as nonskipped macroblocks in DirectX VA macroblock control commands. This is done in order to generate the [*OBMC*](https://msdn.microsoft.com/library/windows/hardware/ff556318#wdkgloss-obmc) effect within these macroblocks.

### <span id="Generating_Skipped_Macroblocks_in_MPEG-2_Example"></span><span id="generating_skipped_macroblocks_in_mpeg-2_example"></span><span id="GENERATING_SKIPPED_MACROBLOCKS_IN_MPEG-2_EXAMPLE"></span>Generating Skipped Macroblocks in MPEG-2 Example

The following example shows how macroblock control commands are used when skipped macroblocks are generated. For demonstration purposes, assume that in an MPEG-2 bitstream seven macroblocks are used in the following manner.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Macroblock Number</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>0</p></td>
<td align="left"><p>Coded with a residual difference</p></td>
</tr>
<tr class="even">
<td align="left"><p>1</p></td>
<td align="left"><p>Skipped</p></td>
</tr>
<tr class="odd">
<td align="left"><p>2</p></td>
<td align="left"><p>Coded with a residual difference</p></td>
</tr>
<tr class="even">
<td align="left"><p>3</p></td>
<td align="left"><p>Skipped</p></td>
</tr>
<tr class="odd">
<td align="left"><p>4</p></td>
<td align="left"><p>Skipped</p></td>
</tr>
<tr class="even">
<td align="left"><p>5</p></td>
<td align="left"><p>Skipped</p></td>
</tr>
<tr class="odd">
<td align="left"><p>6</p></td>
<td align="left"><p>Coded with a residual difference</p></td>
</tr>
</tbody>
</table>

 

These seven macroblocks would require the generation (at least) of the five DirectX VA macroblock control commands shown in the following table. The *MBskipsFollowing* variable indicates the number of skipped macroblocks. The **wMBaddress** member indicates the address of the macroblock. *MBskipsFollowing* and **wMBaddress** are contained in the [**DXVA\_MBctrl\_P\_OffHostIDCT\_1**](https://msdn.microsoft.com/library/windows/hardware/ff563997), and [**DXVA\_MBctrl\_P\_HostResidDiff\_1**](https://msdn.microsoft.com/library/windows/hardware/ff563993) structures. (The *MBskipsFollowing* variable is defined in the **dwMB\_SNL** structure member.)

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Macroblock Command</th>
<th align="left">Member Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>First</p></td>
<td align="left"><p><strong>wMBaddress</strong> = 0</p>
<p><em>MBskipsFollowing</em> = 0</p></td>
</tr>
<tr class="even">
<td align="left"><p>Second</p></td>
<td align="left"><p><strong>wMBaddress</strong> = 1</p>
<p><em>MBskipsFollowing</em> = 0</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Third</p></td>
<td align="left"><p><strong>wMBaddress</strong> = 2</p>
<p><em>MBskipsFollowing</em> = 0</p></td>
</tr>
<tr class="even">
<td align="left"><p>Fourth</p></td>
<td align="left"><p><strong>wMBaddress</strong> = 3</p>
<p><em>MBskipsFollowing</em> = 2</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Fifth</p></td>
<td align="left"><p><strong>wMBaddress</strong> = 6</p>
<p><em>MBskipsFollowing</em> = 0</p></td>
</tr>
</tbody>
</table>

 

 

 





